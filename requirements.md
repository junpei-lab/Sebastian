# Tauri アラームアプリ仕様書（Codex 向けプロンプト）

あなたは **Tauri + Rust + TypeScript + React** に精通したエンジニアです。  
この仕様書に従って、デスクトップ向けアラームアプリケーションを実装してください。

---

## 1. 概要

- アプリ名：**Sebastian**
- 種別：デスクトップアプリ
- フレームワーク：
  - バックエンド：**Tauri（最新安定版） + Rust**
  - フロントエンド：**React + TypeScript**
- 対象 OS：
  - Windows 10/11（x64）
  - macOS（Apple Silicon / Intel のいずれか片方サポートでもよい。まずは開発環境に合わせる）
- 特徴：
  - シンプルなアラームアプリ
  - アプリウィンドウを閉じてもタスクトレイ（システムトレイ）に常駐
  - アラーム時はウィンドウを **最前面に強制表示** ＋ 音を鳴らす
  - Electron より軽量な配布サイズを目指す（Tauri を利用）

---

## 2. 目的

- 日常的に PC 上で利用する小さなアラームツールを作る。
- 「軽量」「邪魔にならない」「アラーム時だけ主張する」挙動を実現する。
- Electron のような重量級ランタイムを避けるため、Tauri を採用する。

---

## 3. 機能要件

### 3.1 アラーム管理

1. **アラーム一覧**

   - 登録済みアラームを一覧表示する。
   - 各アラームに以下の情報を持つ：
     - アラーム時刻（時刻指定。日付は当日想定でよいが、将来拡張を見据えて日付＋時刻で保持してもよい）
     - タイトル（任意文字列、例：「会議」「休憩おわり」）
     - リンク用 URL（任意。空欄の場合は無効扱い。設定されていれば既定ブラウザで開ける）
     - 繰り返し設定（繰り返し有効トグルと曜日リスト。詳細は 3.2-5 参照）
   - 一覧には以下の要素を含む：
     - タイトル
     - 時刻
     - URL リンクボタン（URL 設定があるときのみ表示し、クリックで OS 既定ブラウザを開く）
     - 繰り返し表示（例：ON/OFF 表示と曜日バッジ。曜日未選択の場合は警告を表示）
     - 削除ボタン

2. **アラーム追加**

   - 時刻とタイトルを入力してアラームを追加できる。
   - 入力 UI：
     - 時刻入力（HH:MM）
     - タイトル入力（テキストボックス）
      - URL 入力（任意。http/https のみ許可し、保存前に形式チェックを行う）
      - 繰り返し有効トグル（デフォルト OFF。ON のときだけ曜日選択 UI を表示）
      - 曜日選択（複数選択可。月〜日の 7 チェックボックスやトグルボタン群を想定）
     - 追加ボタン

3. **アラーム編集（最小限）**

   - 一覧上でタイトルの変更ができればよい。
   - 時刻編集は「削除して再登録」でもよい（UI が簡潔な方を優先）。

4. **アラームの永続化**
   - アラーム情報はローカルに保存し、アプリ再起動後も保持される。
   - 保存先は Tauri が推奨する形式でよい（例：`tauri::api::path::app_dir` 配下の JSON ファイルなど）。
   - 保存データには URL／繰り返し有効フラグ／曜日（配列）も含め、将来的なスキーマ変更に備えてバージョン番号を付けてもよい。

### 3.2 アラーム発火時の動作

1. **時間判定**

   - バックエンド（Rust/Tauri 側）またはフロントエンド側で、定期的なタイマー処理を行い、
     アラーム時刻に達したかを判定する。
   - 実装方法は任せるが、アプリ起動中はアラームの取りこぼしがないようにする。

2. **前面表示**

   - アラーム時刻になると、以下を実行する：
     - ウィンドウを `show()` する（非表示／最小化状態でも表示）。
     - ウィンドウを **最前面（always on top）** に設定する。
     - 必要なら `focus()` してアクティブにする。
   - 前面表示は Tauri のウィンドウ API（`set_always_on_top(true)` など）で実現する。

3. **サウンド再生**

   - 短いアラーム音（1 種類でよい）を鳴らす。
   - 実装方法：
     - フロントエンドの `<audio>` タグ／`Audio` オブジェクトを使って `alarm.mp3`（または `ogg`）を再生。
   - 同じ音源をループ再生して、ユーザーが停止するまで鳴り続けてもよい。

4. **アラーム停止操作**
   - アラームが鳴っている状態で：
     - 「停止」ボタンを押すと音が止まり、必要に応じてウィンドウを最前面状態から解除する。
   - アラーム発火後の挙動は簡易でよいが、単発アラームは鳴動後に一覧から自動削除する仕様に統一する（停止ボタンを押したタイミングで削除処理を実行）。繰り返しが有効な場合は 3.2-6 のロジックを適用する。
5. **URL 起動ボタン**

   - アラーム鳴動用ダイアログ／モーダルに「リンクを開く」ボタンを追加する（URL 設定がある場合のみ活性）。
   - クリック時は OS 既定ブラウザで URL を開く。Tauri の `shell::open` または `tauri::api::shell::open` 等を利用する。
   - URL が無効なときはボタンを非活性にし、ユーザーに編集を促す。

6. **繰り返し時の自動処理**

   - 繰り返しが無効（単発）のアラームは、鳴動後に一覧から自動削除する（ユーザーが停止ボタンを押したタイミングで削除）。
   - 繰り返しが有効なアラームは、ユーザーが選択した曜日＋同時刻のみで再スケジュールする。該当しない曜日はスキップ。
   - 曜日が 1 つも選択されていない状態で繰り返しが ON の場合は、アラームを発火させず警告表示に戻す／自動的に OFF に戻すなどのガードを入れる。

---

## 4. ウィンドウ／トレイ動作仕様

### 4.1 メインウィンドウ

- 初回起動時：
  - 通常のウィンドウとして表示する。
- ウィンドウの最小要件：
  - サイズ：800x600 程度（PC での利用を前提とする）
  - OS の標準タイトルバーを使ってよい（カスタムタイトルバーは必須要件ではない）。

### 4.2 閉じる・最小化の挙動

- 「×」ボタン（ウィンドウクローズ）や最小化操作時の挙動をカスタマイズする。

1. **閉じるボタン（×）**

   - デフォルトの「アプリ終了」ではなく、
     - メインウィンドウを `hide()` する。
     - アプリ本体はバックグラウンドで動作し続ける。
   - 実際の終了は「トレイメニューから終了」を行ったときのみ。

2. **最小化**
   - 可能なら、最小化時もタスクバーから消してトレイ常駐にしてよい。
   - 難しい場合、最小化は単純に最小化でもよいが、**閉じるボタンは必ずトレイに送る挙動**とする。

### 4.3 システムトレイ（タスクトレイ）アイコン

- Tauri の System Tray 機能を使い、タスクトレイに常駐アイコンを表示する。
- トレイアイコンの仕様：
  - アイコン画像：簡単なベルのようなアイコン（ダミー画像でよい）
- トレイメニュー：
  - 「表示」：メインウィンドウを表示・フォーカス。
  - 「終了」：アプリケーションを完全終了。
- トレイアイコン左クリック（または macOS では適切な操作）で、
  - メインウィンドウの表示／復帰を行ってもよい。

---

## 5. 非機能要件

1. **軽量さ**

   - Tauri を利用し、Electron よりも軽量なバイナリサイズを目指す。
   - フロントエンドの依存ライブラリを最小限にし、UI フレームワーク（Material UI など大型のもの）は使わない。

2. **起動速度**

   - アプリ起動はできるだけ高速であること。
   - 画面遷移も極力少なくし、単一画面構成で良い。

3. **安定性**
   - アラーム処理中に例外などで落ちないように注意する。
   - ファイル IO 失敗時などはログ出力し、アプリは落とさない。

---

## 6. UI 要件（ざっくり）

- フロントエンドは **React + TypeScript** ベース。
- デザインはシンプルでよく、以下を満たせば十分：
  - 上部に「新規アラーム追加」フォーム（時刻入力、タイトル入力、追加ボタン）。
  - 新規追加フォームに URL 入力欄と繰り返しトグル＋曜日選択 UI（7 つのチェックボックスなど）を配置し、繰り返し ON 時のみ曜日 UI を表示する。
  - 下部に「アラーム一覧」テーブルまたはカード表示。
  - 各アラームカードに URL リンクボタンを置き、繰り返し状態（ON/OFF と曜日バッジ）を視覚的に確認できるようにする。
  - アラーム発火時は：
    - 大きめの文字で「アラームタイトル」「時刻」を表示。
    - 「停止」ボタンを配置。
    - URL 設定がある場合は「リンクを開く」ボタンも配置し、クリックでブラウザを起動する。
- ダークテーマ対応は必須ではない（余裕があれば対応してよい）。

---

## 7. 実装上の方針・ディレクトリ構成（例）

- Tauri 標準テンプレートをベースにすること。
- 構成イメージ：

```

project-root/
src-tauri/
src/
main.rs           // Tauri エントリポイント、トレイとウィンドウ制御、アラーム判定ロジック（Rust）
alarm_store.rs    // アラームのモデル・永続化処理（JSON 読み書き）
tauri.conf.json
src/
main.tsx           // React エントリポイント
App.tsx            // メイン画面
components/
AlarmList.tsx
AlarmForm.tsx
AlarmDialog.tsx  // アラーム鳴動中の表示コンポーネント（あれば）
types/
alarm.ts         // アラームの型定義

```

- Rust 側とフロントエンド側の通信は、Tauri の `invoke` API で行う。

---

## 8. Codex への具体的な指示

この仕様に基づき、以下を行ってください。

1. **Tauri プロジェクトの初期化に必要なファイル群を生成**してください。

- `src-tauri/main.rs`
- `tauri.conf.json`
- `src/main.tsx`
- `src/App.tsx`
- 必要なコンポーネントファイル

2. Rust 側：

- アラームのデータ構造定義。
- JSON ファイルへの保存・読み込みロジック。
- アラーム時間をチェックするタイマー処理（シンプルなポーリングでよい）。
- アラーム発火時にフロントエンドに通知する仕組み（イベント、または `emit` 等）。
- URL フィールドと繰り返し設定（フラグ＋曜日配列）を含む永続化／読み込み、および既定ブラウザで URL を開く処理（`shell::open` 想定）。
- 繰り返し有効時のみ次回発火日時を再計算し、単発時は鳴動直後にエントリを削除するロジック。

3. フロントエンド側（React + TypeScript）：

- アラーム一覧画面 UI。
- アラーム追加フォーム。
- アラーム鳴動中の画面および停止ボタン。
- URL 入力欄、リンクボタン、繰り返しトグル＋曜日選択 UI（バリデーション含む）。
- バックエンドとの通信（`invoke`・イベントリスナー）実装。
- 音声再生の実装（`<audio>` など）。

4. ウィンドウ制御・トレイ制御：

- `SystemTray` の設定とイベントハンドラ。
- 「表示」「終了」メニューの実装。
- 閉じるボタン時にウィンドウを非表示にしてトレイ常駐させるロジック。
- アラーム発火時に `set_always_on_top(true)` + `show()` + `set_focus()` する処理。

5. 可能な限り、**コード内コメントを日本語**で記述してください。

- 何をしているか、どの Tauri API を使っているかがわかるようにする。

この仕様書を満たす方向でコードを出力してください。
